<!--
  Paramedic Documentation Suite
  Version: 2.1.0 | Author: Vlad da Cunha
  Verified for internal use.
  Integrity Checksum: d1d564f15de4b0411b78de886bd109385cce8d2356030d0ab5395c50d8365317
  Generated: 2025-11-13
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FLACC Pain Assessment - Smart Paramedics</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-Avb2QiuDEEvB4bZJYdft2mNjVShBftLdPG8FJ0V7irTLQ8Uo0qcPxh4Plq7G5tGm0rU+1SPhVotteLpBERwTkw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
   <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
   <link rel="icon" type="image/png" href="favicon.png">
  
  <!-- Apple Web App Settings -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#006666">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Smart&nbsp;Paramedics">

  <!-- App Icon for Apple Devices -->
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="167x167" href="/ipad-touch-icon.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/ipad-touch-icon-152.png">


  <meta name="author" content="Vlad da Cunha">
  <meta name="description" content="Clinical documentation support tool for paramedics â€“ VIRCA, MSE, and FLACC statement generation.">
  <meta name="version" content="2.1.0">
  <meta name="last-updated" content="2025-11-13">


<!-- Safe and CSP-compliant meta -->
<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
<meta http-equiv="Permissions-Policy"
      content="geolocation=(), microphone=(), camera=(), accelerometer=(), magnetometer=(), gyroscope=(), fullscreen=(self)">
<meta http-equiv="Content-Security-Policy"
      content="default-src 'self';
               style-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline';
               script-src 'self' https://code.jquery.com https://cdnjs.cloudflare.com https://static.cloudflareinsights.com 'unsafe-inline';
               font-src 'self' https://cdnjs.cloudflare.com data:;
               img-src 'self' data:;
               connect-src 'self';">
</head>
<body>

<!-- Header loaded dynamically -->
<div id="header-placeholder"></div>

<div class="container">
  <div class="left">
    <h2 class="tool-title">FLACC Pain Assessment</h2>

    <div class="section">
      <h3>General Notes</h3>
      <p class="description">Optional context such as setting, baseline behaviour, or interventions (e.g., parental presence, analgesia).</p>
      <textarea id="flacc-notes" placeholder="Add overall context or notes (optional)..."></textarea>
    </div>

    <!-- Each FLACC category -->
    <div class="section" id="faces-section">
      <h3>Faces</h3>
      <div class="checkbox-group">
        <label><input type="radio" name="faces" value="0" data-text="No particular expression or smile"> 0 - No particular expression or smile</label>
        <label><input type="radio" name="faces" value="1" data-text="Occasional grimace or frown; withdrawn, disinterested"> 1 - Occasional grimace/frown; withdrawn, disinterested</label>
        <label><input type="radio" name="faces" value="2" data-text="Frequent or constant frown; clenched jaw; quivering chin"> 2 - Frequent or constant frown; clenched jaw; quivering chin</label>
      </div>
    </div>

    <div class="section" id="legs-section">
      <h3>Legs</h3>
      <div class="checkbox-group">
        <label><input type="radio" name="legs" value="0" data-text="Normal position or relaxed"> 0 - Normal position or relaxed</label>
        <label><input type="radio" name="legs" value="1" data-text="Uneasy, restless, or tense"> 1 - Uneasy, restless, or tense</label>
        <label><input type="radio" name="legs" value="2" data-text="Kicking or legs drawn up"> 2 - Kicking or legs drawn up</label>
      </div>
    </div>

    <div class="section" id="activity-section">
      <h3>Activity</h3>
      <div class="checkbox-group">
        <label><input type="radio" name="activity" value="0" data-text="Lying quietly; normal position; moves easily"> 0 - Lying quietly; normal position; moves easily</label>
        <label><input type="radio" name="activity" value="1" data-text="Squirming; shifting back and forth; tense"> 1 - Squirming; shifting back and forth; tense</label>
        <label><input type="radio" name="activity" value="2" data-text="Arched, rigid, or jerking"> 2 - Arched, rigid, or jerking</label>
      </div>
    </div>

    <div class="section" id="cry-section">
      <h3>Cry</h3>
      <div class="checkbox-group">
        <label><input type="radio" name="cry" value="0" data-text="No cry (awake or asleep)"> 0 - No cry (awake or asleep)</label>
        <label><input type="radio" name="cry" value="1" data-text="Moans or whimpers; occasional complaint"> 1 - Moans or whimpers; occasional complaint</label>
        <label><input type="radio" name="cry" value="2" data-text="Crying steadily; screams or sobs; frequent complaints"> 2 - Crying steadily; screams or sobs; frequent complaints</label>
      </div>
    </div>

    <div class="section" id="consolability-section">
      <h3>Consolability</h3>
      <div class="checkbox-group">
        <label><input type="radio" name="consolability" value="0" data-text="Content and relaxed"> 0 - Content and relaxed</label>
        <label><input type="radio" name="consolability" value="1" data-text="Reassured by occasional touching, hugging, or talking; distractible"> 1 - Reassured by occasional touching, hugging, or talking; distractible</label>
        <label><input type="radio" name="consolability" value="2" data-text="Difficult to console or comfort"> 2 - Difficult to console or comfort</label>
      </div>
    </div>
  </div>

  <div class="right">
    <h2 class="tool-title">Generated FLACC Summary</h2>
    <div id="output"></div>
    <button id="copyAll">ðŸ“‹ Copy Full FLACC Summary</button>
  </div>
</div>

<button id="toggleView" class="toggle-btn">
  <i class="fas fa-arrow-down"></i> Jump to Output
</button>

<div id="footer-placeholder"></div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  fetch("header.html").then(r=>r.text()).then(h=>{document.getElementById("header-placeholder").innerHTML = h;});
  fetch("footer.html").then(r=>r.text()).then(f=>{document.getElementById("footer-placeholder").innerHTML = f;});
});

$(document).ready(function(){
  const groups = ['faces','legs','activity','cry','consolability'];

  function getSelection(name) {
    const $sel = $(`input[name="${name}"]:checked`);
    if ($sel.length === 0) return {score: null, text: ''};
    return {score: parseInt($sel.val(), 10), text: $sel.data('text')};
  }

  function painCategory(total) {
    if (total === 0) return 'relaxed and comfortable';
    if (total <= 3) return 'mild discomfort';
    if (total <= 6) return 'moderate pain';
    return 'severe pain';
  }

  function buildText(){
  const sel = {};
  let total = 0;
  groups.forEach(g => {
    sel[g] = getSelection(g);
    if (sel[g].score !== null && !isNaN(sel[g].score)) total += sel[g].score;
  });

  const notes = $('#flacc-notes').val().trim();
  const category = painCategory(total);

  let outputText = `FLACC Score: ${isNaN(total) ? 'â€”' : total}/10 - ${category}`;
  if (notes) outputText += `\n\nNotes: ${notes}\n`;
  outputText += `\n`;

  groups.forEach(g => {
    if (sel[g].text) {
      const header = g.charAt(0).toUpperCase() + g.slice(1);
      outputText += `${header}: ${sel[g].score} - ${sel[g].text}\n`;
    }
  });

  const html = outputText.split('\n').filter(Boolean).map(line => `<div class='sentence'><strong>${line}</strong></div>`).join('');
  $('#output').html(html);
}


  $(document).on('change', 'input[type="radio"]', buildText);

  $('#copyAll').on('click', function(){
    const text = $('#output .sentence').map((_,e)=>$(e).text().trim()).get().join("\n");
    navigator.clipboard.writeText(text);
    $(this).text('âœ… Copied!');
    setTimeout(()=>$(this).text('ðŸ“‹ Copy Full FLACC Summary'),1200);
  });

  buildText();
});

// Floating toggle logic (mobile only; fade in/out)
$(document).ready(function () {

  var $btn   = $('#toggleView');
  var $left  = $('.left');
  var $right = $('.right');
  var showingOutput = false;

  if (!$btn.length || !$left.length || !$right.length) return;

  function updateButtonLabel(isOutput) {
    $btn.html(
      isOutput
        ? '<i class="fas fa-arrow-up"></i> Jump to Input'
        : '<i class="fas fa-arrow-down"></i> Jump to Output'
    );
  }

  function detectOutputVisible() {
    var rect = $right.get(0).getBoundingClientRect();

    // Output is active if its top is inside or above the viewport
    return rect.top <= window.innerHeight * 0.25; 
    // ^ tweakable threshold if needed
  }

  function onScroll() {
    var scrollTop = $(window).scrollTop();
    var winHeight = $(window).height();
    var docHeight = $(document).height();

    var atBottom = scrollTop + winHeight >= docHeight - 110;

    // Hide at bottom
    if (atBottom) {
      $btn.removeClass('visible');
      return;
    }

    // Hide at top
    if (scrollTop <= 120) {
      $btn.removeClass('visible');
      showingOutput = false;
      updateButtonLabel(false);
      return;
    }

    // Show button in the middle
    $btn.addClass('visible');

    // AUTO TOGGLE TEXT BASED ON WHICH PANEL IS ON SCREEN
    if (detectOutputVisible()) {
      if (!showingOutput) {
        showingOutput = true;
        updateButtonLabel(true);
      }
    } else {
      if (showingOutput) {
        showingOutput = false;
        updateButtonLabel(false);
      }
    }
  }

  // Scroll listener
  $(window).on('scroll', onScroll);

  // Handle rotation / resize
  $(window).on('resize orientationchange', function () {
    setTimeout(onScroll, 300);
  });

  // Click handler
  $btn.on('click', function () {
    if (!showingOutput) {
      $right.get(0).scrollIntoView({ behavior: 'smooth' });
      showingOutput = true;
      updateButtonLabel(true);
    } else {
      $left.get(0).scrollIntoView({ behavior: 'smooth' });
      showingOutput = false;
      updateButtonLabel(false);
    }
  });

  // Initial run
  onScroll();
});


//Add current year to footer
$(document).ready(function() {
  $.get("footer.html", function(html) {
    $("#footer-placeholder").html(html);
    $("#currentYear").text(new Date().getFullYear());
  });
});
</script>

</body>
</html>
